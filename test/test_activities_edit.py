#!/usr/bin/env python3

import sys
import os
import json

lib_path = os.path.join(os.path.dirname(os.path.abspath(__file__)), "../lib")
sys.path.append(lib_path)

import unittest
from activities_edit import *

class Test_Data(unittest.TestCase):
    def check_data_activity(self):
        with open('./data/test_4-0.json') as f:
            test_four_zero = json.load(f)
        output_four_zero = boundingbox_merge(test_four_zero, 'activity')
        assert(output_four_zero == {'filesProcessed': ['VIRAT_S_000000.mp4'], 'activities': [{'activity': 'Closing', 'activityID': 1, 'localization': {'VIRAT_S_000000.mp4': {'3034': 1, '3062': 0}}, 'objects': [{'objectType': 'Other', 'objectID': 1, 'localization': {'VIRAT_S_000000.mp4': {'3034': {'boundingBox': {'h': 130, 'w': 170, 'x': 10, 'y': 30}}, '3062': {}}}}]}, {'activity': 'Entering', 'activityID': 2, 'localization': {'VIRAT_S_000000.mp4': {'3845': 1, '3897': 0}}, 'objects': [{'objectType': 'Other', 'objectID': 1, 'localization': {'VIRAT_S_000000.mp4': {'3845': {'boundingBox': {'h': 130, 'w': 170, 'x': 10, 'y': 30}}, '3897': {}}}}]}, {'activity': 'Entering', 'activityID': 3, 'localization': {'VIRAT_S_000000.mp4': {'6070': 1, '6099': 0}}, 'objects': [{'objectType': 'Other', 'objectID': 1, 'localization': {'VIRAT_S_000000.mp4': {'6070': {'boundingBox': {'h': 290, 'w': 140, 'x': 10, 'y': 30}}, '6099': {}}}}]}]})

        with open('./data/test_6-0.json') as f:
            test_six_zero = json.load(f)
        output_six_zero = boundingbox_merge(test_six_zero, 'activity')
        assert(output_six_zero == {'filesProcessed': ['VIRAT_S_040103_03_000284_000425.mp4'], 'activities': [{'activity': 'Opening', 'activityID': 1, 'localization': {'VIRAT_S_040103_03_000284_000425.mp4': {'1557': 1, '1826': 0}}, 'objects': [{'localization': {'VIRAT_S_040103_03_000284_000425.mp4': {'1557': {'boundingBox': {'h': 57, 'w': 29, 'x': 282, 'y': 16}}, '1826': {}}}, 'objectID': 1, 'objectType': 'Other'}]}]})

        with open('./data/test_7-1.json') as f:
            test_seven_one = json.load(f)
        output_seven_one = boundingbox_merge(test_seven_one, 'activity')
        assert(output_seven_one == {'filesProcessed': ['VIRAT_S_000000.mp4', 'VIRAT_S_999999.mp4'], 'activities': [{'activity': 'Closing', 'activityID': 1, 'localization': {'VIRAT_S_000000.mp4': {'3034': 1, '3062': 0}}, 'objects': [{'objectType': 'Other', 'objectID': 1, 'localization': {'VIRAT_S_000000.mp4': {'3034': {'boundingBox': {'h': 130, 'w': 170, 'x': 10, 'y': 30}}, '3062': {}}}}]}, {'activity': 'Entering', 'activityID': 2, 'localization': {'VIRAT_S_000000.mp4': {'3845': 1, '3897': 0}, 'VIRAT_S_999999.mp4': {'3840': 1, '3898': 0}}, 'objects': [{'objectType': 'Other', 'objectID': 1, 'localization': {'VIRAT_S_000000.mp4': {'3845': {'boundingBox': {'h': 130, 'w': 170, 'x': 10, 'y': 30}}, '3897': {}}, 'VIRAT_S_999999.mp4': {'3840': {'boundingBox': {'x': 10, 'y': 30, 'w': 50, 'h': 20}}, '3898': {}}}}]}, {'activity': 'Entering', 'activityID': 3, 'localization': {'VIRAT_S_000000.mp4': {'6070': 1, '6099': 0}}, 'objects': [{'objectType': 'Other', 'objectID': 1, 'localization': {'VIRAT_S_000000.mp4': {'6070': {'boundingBox': {'h': 290, 'w': 140, 'x': 10, 'y': 30}}, '6099': {}}}}]}, {'activity': 'Entering', 'activityID': 90, 'localization': {'VIRAT_S_999999.mp4': {'6070': 1, '6099': 0}}, 'objects': [{'objectType': 'Other', 'objectID': 1, 'localization': {'VIRAT_S_999999.mp4': {'6070': {'boundingBox': {'h': 290, 'w': 140, 'x': 10, 'y': 30}}, '6099': {}}}}]}]})

        with open('./data/test_8-0.json') as f:
            test_eight_zero = json.load(f)
        output_eight_zero = boundingbox_merge(test_eight_zero, 'activity')
        assert(output_eight_zero == {'filesProcessed': ['VIRAT_S_000000.mp4'], 'activities': [{'activity': 'Closing', 'activityID': 1, 'localization': {'VIRAT_S_000000.mp4': {'44989': 1, '45013': 0}}, 'objects': [{'objectType': 'Other', 'objectID': 1, 'localization': {'VIRAT_S_000000.mp4': {'44989': {'boundingBox': {'h': 20, 'w': 50, 'x': 10, 'y': 30}}, '45013': {}}}}]}]})

    def check_data_activity(self):
        with open('./data/test_16-0.json') as f:
            test_sixteen_zero = json.load(f)
        output_sixteen_zero = boundingbox_merge(test_sixteen_zero, 'frame')
        assert(output_sixteen_zero == {'filesProcessed': ['VIRAT_S_000000.mp4'], 'activities': [{'activity': 'Closing', 'activityID': 1, 'presenceConf': 0.756, 'alertFrame': 3062, 'localization': {'VIRAT_S_000000.mp4': {'3034': 1, '3062': 0}}, 'objects': [{'objectType': 'Other', 'objectID': 1, 'localization': {'VIRAT_S_000000.mp4': {'3034': {'boundingBox': {'h': 150, 'w': 180, 'x': 0, 'y': 10}}, '3052': {'boundingBox': {'h': 202, 'w': 580, 'x': 0, 'y': 10}}, '3062': {}}}}]}, {'activity': 'Closing', 'activityID': 2, 'presenceConf': 0.774, 'alertFrame': 19982, 'localization': {'VIRAT_S_000000.mp4': {'3034': 1, '3062': 0}}, 'objects': [{'objectType': 'Other', 'objectID': 1, 'localization': {'VIRAT_S_000000.mp4': {'3034': {'boundingBox': {'h': 150, 'w': 180, 'x': 0, 'y': 10}}, '3062': {}}}}]}, {'activity': 'Entering', 'activityID': 3, 'presenceConf': 0.652, 'alertFrame': 3897, 'localization': {'VIRAT_S_000000.mp4': {'3845': 1, '3897': 0}}, 'objects': [{'objectType': 'Other', 'objectID': 1, 'localization': {'VIRAT_S_000000.mp4': {'3845': {'boundingBox': {'h': 130, 'w': 170, 'x': 10, 'y': 30}}, '3897': {}}}}]}, {'activity': 'Entering', 'activityID': 4, 'presenceConf': 0.769, 'alertFrame': 6098, 'localization': {'VIRAT_S_000000.mp4': {'6067': 1, '6098': 0}}, 'objects': []}]})
        with open('./data/test_17-0.json') as f:
            test_seventeen_zero = json.load(f)
        output_seventeen_zero = boundingbox_merge(test_seventeen_zero, 'frame')
        assert(output_seventeen_zero == {'activities': [{'activity': 'activity_0', 'activityID': 58, 'localization': {'video_0.avi': {'4': 1, '36': 0}}, 'objects': [{'localization': {'video_0.avi': {'4': {'boundingBox': {'h': 36, 'w': 14, 'x': 102, 'y': 43}}, '5': {'boundingBox': {'h': 36, 'w': 15, 'x': 102, 'y': 43}}, '6': {'boundingBox': {'h': 36, 'w': 14, 'x': 102, 'y': 43}}, '7': {'boundingBox': {'h': 64, 'w': 41, 'x': 18, 'y': 31}}, '8': {'boundingBox': {'h': 65, 'w': 44, 'x': 12, 'y': 29}}, '9': {'boundingBox': {'h': 65, 'w': 47, 'x': 6, 'y': 8}}, '10': {'boundingBox': {'h': 3, 'w': 4, 'x': 98, 'y': 42}}, '11': {'boundingBox': {'h': 3, 'w': 16, 'x': 99, 'y': 42}}, '12': {'boundingBox': {'h': 39, 'w': 17, 'x': 86, 'y': 29}}, '13': {'boundingBox': {'h': 59, 'w': 15, 'x': 98, 'y': 31}}, '14': {'boundingBox': {'h': 5, 'w': 18, 'x': 78, 'y': 33}}, '15': {'boundingBox': {'h': 58, 'w': 14, 'x': 97, 'y': 43}}, '16': {'boundingBox': {'h': 38, 'w': 13, 'x': 97, 'y': 37}}, '17': {'boundingBox': {'h': 57, 'w': 40, 'x': 65, 'y': 37}}, '18': {'boundingBox': {'h': 57, 'w': 41, 'x': 61, 'y': 37}}, '19': {'boundingBox': {'h': 35, 'w': 14, 'x': 95, 'y': 37}}, '20': {'boundingBox': {'h': 35, 'w': 14, 'x': 95, 'y': 43}}, '21': {'boundingBox': {'h': 55, 'w': 14, 'x': 48, 'y': 47}}, '22': {'boundingBox': {'h': 55, 'w': 14, 'x': 44, 'y': 36}}, '23': {'boundingBox': {'h': 55, 'w': 49, 'x': 94, 'y': 43}}, '24': {'boundingBox': {'h': 55, 'w': 49, 'x': 90, 'y': 45}}, '25': {'boundingBox': {'h': 55, 'w': 49, 'x': 41, 'y': 35}}, '26': {'boundingBox': {'h': 54, 'w': 49, 'x': 42, 'y': 35}}, '27': {'boundingBox': {'h': 54, 'w': 49, 'x': 43, 'y': 45}}, '28': {'boundingBox': {'h': 54, 'w': 47, 'x': 41, 'y': 35}}, '29': {'boundingBox': {'h': 35, 'w': 14, 'x': 98, 'y': 45}}, '30': {'boundingBox': {'h': 55, 'w': 47, 'x': 35, 'y': 36}}, '35': {'boundingBox': {'h': 35, 'w': 17, 'x': 91, 'y': 45}}, '36': {}}}, 'objectID': 1, 'objectType': 'Other'}]}, {'activity': 'activity_2', 'activityID': 2, 'localization': {'video_2.mp4': {'6285': 1, '6338': 0}}, 'objects': [{'localization': {'video_2.mp4': {'6285': {'boundingBox': {'h': 38, 'w': 21, 'x': 686, 'y': 638}}, '6286': {'boundingBox': {'h': 37, 'w': 21, 'x': 686, 'y': 638}}, '6287': {'boundingBox': {'h': 35, 'w': 22, 'x': 686, 'y': 638}}, '6288': {'boundingBox': {'h': 35, 'w': 23, 'x': 685, 'y': 637}}, '6289': {'boundingBox': {'h': 33, 'w': 23, 'x': 685, 'y': 637}}, '6290': {'boundingBox': {'h': 32, 'w': 23, 'x': 685, 'y': 637}}, '6291': {'boundingBox': {'h': 32, 'w': 24, 'x': 684, 'y': 636}}, '6292': {'boundingBox': {'h': 30, 'w': 25, 'x': 684, 'y': 636}}, '6293': {'boundingBox': {'h': 29, 'w': 25, 'x': 684, 'y': 636}}, '6298': {'boundingBox': {'h': 32, 'w': 23, 'x': 686, 'y': 637}}, '6299': {'boundingBox': {'h': 35, 'w': 23, 'x': 687, 'y': 639}}, '6300': {'boundingBox': {'h': 38, 'w': 21, 'x': 689, 'y': 640}}, '6303': {'boundingBox': {'h': 37, 'w': 21, 'x': 689, 'y': 640}}, '6305': {'boundingBox': {'h': 36, 'w': 22, 'x': 688, 'y': 640}}, '6306': {'boundingBox': {'h': 36, 'w': 21, 'x': 688, 'y': 640}}, '6307': {'boundingBox': {'h': 37, 'w': 21, 'x': 688, 'y': 639}}, '6308': {'boundingBox': {'h': 36, 'w': 21, 'x': 688, 'y': 639}}, '6311': {'boundingBox': {'h': 35, 'w': 21, 'x': 688, 'y': 639}}, '6313': {'boundingBox': {'h': 35, 'w': 20, 'x': 688, 'y': 639}}, '6317': {'boundingBox': {'h': 41, 'w': 86, 'x': 663, 'y': 639}}, '6318': {'boundingBox': {'h': 35, 'w': 20, 'x': 688, 'y': 639}}, '6335': {'boundingBox': {'h': 33, 'w': 21, 'x': 684, 'y': 638}}, '6336': {'boundingBox': {'h': 38, 'w': 21, 'x': 683, 'y': 638}}, '6338': {}}}, 'objectID': 1, 'objectType': 'Other'}]}, {'activity': 'person_opens_facility_door', 'activityID': 42, 'localization': {'a_video.mp4': {'490': 1, '575': 0}}, 'objects': [{'localization': {'a_video.mp4': {'490': {'boundingBox': {'h': 460, 'w': 179, 'x': 1052, 'y': 408}}, '491': {'boundingBox': {'h': 460, 'w': 177, 'x': 1052, 'y': 408}}, '492': {'boundingBox': {'h': 460, 'w': 176, 'x': 1052, 'y': 409}}, '493': {'boundingBox': {'h': 459, 'w': 175, 'x': 1052, 'y': 410}}, '494': {'boundingBox': {'h': 459, 'w': 173, 'x': 1052, 'y': 411}}, '495': {'boundingBox': {'h': 459, 'w': 171, 'x': 1053, 'y': 412}}, '496': {'boundingBox': {'h': 458, 'w': 170, 'x': 1053, 'y': 413}}, '497': {'boundingBox': {'h': 458, 'w': 168, 'x': 1053, 'y': 414}}, '498': {'boundingBox': {'h': 457, 'w': 167, 'x': 1053, 'y': 415}}, '499': {'boundingBox': {'h': 457, 'w': 165, 'x': 1054, 'y': 416}}, '500': {'boundingBox': {'h': 458, 'w': 163, 'x': 1054, 'y': 416}}, '501': {'boundingBox': {'h': 457, 'w': 162, 'x': 1054, 'y': 417}}, '502': {'boundingBox': {'h': 457, 'w': 161, 'x': 1054, 'y': 418}}, '503': {'boundingBox': {'h': 456, 'w': 159, 'x': 1054, 'y': 419}}, '504': {'boundingBox': {'h': 456, 'w': 157, 'x': 1055, 'y': 420}}, '505': {'boundingBox': {'h': 456, 'w': 156, 'x': 1055, 'y': 421}}, '506': {'boundingBox': {'h': 455, 'w': 154, 'x': 1055, 'y': 422}}, '507': {'boundingBox': {'h': 455, 'w': 153, 'x': 1055, 'y': 423}}, '508': {'boundingBox': {'h': 455, 'w': 151, 'x': 1056, 'y': 424}}, '509': {'boundingBox': {'h': 455, 'w': 151, 'x': 1054, 'y': 424}}, '510': {'boundingBox': {'h': 455, 'w': 151, 'x': 1053, 'y': 425}}, '511': {'boundingBox': {'h': 455, 'w': 151, 'x': 1052, 'y': 425}}, '512': {'boundingBox': {'h': 455, 'w': 151, 'x': 1051, 'y': 426}}, '513': {'boundingBox': {'h': 455, 'w': 152, 'x': 1049, 'y': 426}}, '514': {'boundingBox': {'h': 455, 'w': 151, 'x': 1048, 'y': 427}}, '515': {'boundingBox': {'h': 455, 'w': 151, 'x': 1047, 'y': 427}}, '516': {'boundingBox': {'h': 455, 'w': 151, 'x': 1046, 'y': 428}}, '517': {'boundingBox': {'h': 455, 'w': 152, 'x': 1044, 'y': 428}}, '518': {'boundingBox': {'h': 455, 'w': 152, 'x': 1043, 'y': 429}}, '519': {'boundingBox': {'h': 455, 'w': 151, 'x': 1042, 'y': 430}}, '520': {'boundingBox': {'h': 455, 'w': 151, 'x': 1041, 'y': 430}}, '521': {'boundingBox': {'h': 455, 'w': 152, 'x': 1039, 'y': 431}}, '522': {'boundingBox': {'h': 455, 'w': 152, 'x': 1038, 'y': 431}}, '523': {'boundingBox': {'h': 455, 'w': 152, 'x': 1037, 'y': 432}}, '524': {'boundingBox': {'h': 455, 'w': 151, 'x': 1036, 'y': 432}}, '525': {'boundingBox': {'h': 455, 'w': 152, 'x': 1034, 'y': 433}}, '526': {'boundingBox': {'h': 455, 'w': 152, 'x': 1033, 'y': 433}}, '527': {'boundingBox': {'h': 455, 'w': 152, 'x': 1032, 'y': 434}}, '528': {'boundingBox': {'h': 455, 'w': 152, 'x': 1031, 'y': 435}}, '529': {'boundingBox': {'h': 453, 'w': 153, 'x': 1030, 'y': 436}}, '530': {'boundingBox': {'h': 452, 'w': 154, 'x': 1029, 'y': 437}}, '531': {'boundingBox': {'h': 450, 'w': 154, 'x': 1029, 'y': 438}}, '532': {'boundingBox': {'h': 449, 'w': 155, 'x': 1028, 'y': 439}}, '533': {'boundingBox': {'h': 447, 'w': 156, 'x': 1027, 'y': 440}}, '534': {'boundingBox': {'h': 445, 'w': 156, 'x': 1027, 'y': 442}}, '535': {'boundingBox': {'h': 448, 'w': 153, 'x': 1030, 'y': 443}}, '536': {'boundingBox': {'h': 452, 'w': 150, 'x': 1033, 'y': 444}}, '537': {'boundingBox': {'h': 455, 'w': 147, 'x': 1036, 'y': 446}}, '538': {'boundingBox': {'h': 450, 'w': 146, 'x': 1036, 'y': 446}}, '539': {'boundingBox': {'h': 446, 'w': 146, 'x': 1036, 'y': 446}}, '540': {'boundingBox': {'h': 442, 'w': 145, 'x': 1037, 'y': 446}}, '541': {'boundingBox': {'h': 436, 'w': 145, 'x': 1037, 'y': 447}}, '542': {'boundingBox': {'h': 432, 'w': 144, 'x': 1037, 'y': 447}}, '543': {'boundingBox': {'h': 428, 'w': 143, 'x': 1038, 'y': 447}}, '544': {'boundingBox': {'h': 423, 'w': 143, 'x': 1038, 'y': 447}}, '545': {'boundingBox': {'h': 418, 'w': 143, 'x': 1038, 'y': 448}}, '546': {'boundingBox': {'h': 414, 'w': 141, 'x': 1039, 'y': 448}}, '547': {'boundingBox': {'h': 409, 'w': 141, 'x': 1039, 'y': 448}}, '548': {'boundingBox': {'h': 405, 'w': 141, 'x': 1039, 'y': 448}}, '549': {'boundingBox': {'h': 400, 'w': 140, 'x': 1040, 'y': 449}}, '550': {'boundingBox': {'h': 395, 'w': 142, 'x': 1036, 'y': 449}}, '551': {'boundingBox': {'h': 391, 'w': 144, 'x': 1033, 'y': 449}}, '552': {'boundingBox': {'h': 387, 'w': 146, 'x': 1030, 'y': 449}}, '553': {'boundingBox': {'h': 382, 'w': 147, 'x': 1027, 'y': 449}}, '554': {'boundingBox': {'h': 377, 'w': 150, 'x': 1023, 'y': 450}}, '555': {'boundingBox': {'h': 373, 'w': 152, 'x': 1020, 'y': 450}}, '556': {'boundingBox': {'h': 368, 'w': 153, 'x': 1017, 'y': 450}}, '557': {'boundingBox': {'h': 364, 'w': 155, 'x': 1014, 'y': 450}}, '558': {'boundingBox': {'h': 359, 'w': 157, 'x': 1011, 'y': 451}}, '559': {'boundingBox': {'h': 358, 'w': 156, 'x': 1008, 'y': 451}}, '560': {'boundingBox': {'h': 357, 'w': 156, 'x': 1005, 'y': 451}}, '561': {'boundingBox': {'h': 356, 'w': 156, 'x': 1002, 'y': 451}}, '562': {'boundingBox': {'h': 355, 'w': 156, 'x': 999, 'y': 451}}, '563': {'boundingBox': {'h': 354, 'w': 155, 'x': 997, 'y': 452}}, '564': {'boundingBox': {'h': 354, 'w': 153, 'x': 996, 'y': 451}}, '565': {'boundingBox': {'h': 354, 'w': 152, 'x': 995, 'y': 451}}, '566': {'boundingBox': {'h': 354, 'w': 151, 'x': 994, 'y': 450}}, '567': {'boundingBox': {'h': 354, 'w': 149, 'x': 993, 'y': 450}}, '568': {'boundingBox': {'h': 354, 'w': 148, 'x': 992, 'y': 449}}, '569': {'boundingBox': {'h': 354, 'w': 147, 'x': 991, 'y': 449}}, '570': {'boundingBox': {'h': 354, 'w': 146, 'x': 990, 'y': 448}}, '571': {'boundingBox': {'h': 354, 'w': 144, 'x': 989, 'y': 448}}, '572': {'boundingBox': {'h': 354, 'w': 143, 'x': 988, 'y': 447}}, '573': {'boundingBox': {'h': 354, 'w': 142, 'x': 987, 'y': 447}}, '574': {'boundingBox': {'h': 354, 'w': 141, 'x': 986, 'y': 447}}, '575': {}}}, 'objectID': 1, 'objectType': 'Other'}]}], 'filesProcessed': ['some_videos.mp4']})

    